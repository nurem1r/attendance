<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Student List</title>
    <style>
        /* Strict inline style for Student List */
        :root{--bg:#f5f7fb;--card:#fff;--text:#0f1724;--muted:#6b7280;--primary:#0b5ed7;--border:#e6eefc;--radius:8px}
        body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;color:var(--text);padding:28px}
        .container{max-width:1200px;margin:0 auto}
        .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
        .title{font-size:1.4rem;font-weight:700}
        .back{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;background:#f0f6ff;color:var(--primary);text-decoration:none;border:1px solid var(--border);font-weight:700}
        .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(8,20,50,0.04)}
        .search{display:flex;gap:8px;margin-bottom:12px}
        .search input{flex:1;padding:10px;border-radius:6px;border:1px solid #dbe8ff}
        .btn{padding:8px 12px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
        .btn-primary{background:linear-gradient(135deg,var(--primary),#093a88);color:#fff}
        table{width:100%;border-collapse:collapse}
        thead th{background:var(--primary);color:#fff;padding:10px;border-radius:4px 4px 0 0;text-align:left;font-weight:700}
        tbody td{padding:10px;border-bottom:1px solid #eef4ff}
        .center{display:flex;justify-content:center}
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="title">Student List</div>
        <a th:href="@{/manager}" class="back">Back to Dashboard</a>
    </div>

    <div class="card">
        <div class="search">
            <form th:action="@{/manager/student_list}" method="get" style="display:flex;flex:1;">
                <input type="text" name="q" placeholder="Search by name or code" th:value="${param.q}" />
                <button class="btn btn-primary" type="submit">Search</button>
            </form>
        </div>

        <table>
            <thead>
            <tr><th>Full Name</th><th>Student ID</th><th>Teacher</th><th>Package</th><th>Remaining</th><th>Debt</th><th>Missed</th><th>Actions</th></tr>
            </thead>
            <tbody>
            <tr th:each="s, stat : ${students}">
                <td th:text="${s.firstName + ' ' + s.lastName}">Name</td>
                <td th:text="${s.studentCode}">CODE</td>
                <td th:text="${teacherMap != null and teacherMap.containsKey(s.teacherId) ? teacherMap[s.teacherId].firstName + ' ' + teacherMap[s.teacherId].lastName : '-'}">Teacher</td>
                <td th:text="${s.packageType}">PKG</td>
                <td th:text="${s.packageType != null && s.packageType.name() == 'UNLIMITED' ? 'âˆž' : (s.remainingLessons != null ? s.remainingLessons : 0)}">0</td>
                <td th:text="${s.debt != null ? s.debt : 0}">0</td>
                <td th:text="${missedMap != null && missedMap.containsKey(s.id) ? missedMap[s.id] : 0}">0</td>
                <td>
                    <div style="display:flex;gap:8px">
                        <button class="btn btn-primary" type="button" th:onclick="|markAndSubmit(${s.id}, 'PRESENT')|">P</button>
                        <button class="btn" type="button" th:onclick="|markAndSubmit(${s.id}, 'ABSENT')|">A</button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    function markAndSubmit(id,status){
        const form=document.createElement('form'); form.method='post'; form.action='/*[[${"/teacher/attendance/save"}]]*/ /teacher/attendance/save';
        const csName=/*[[${_csrf.parameterName}]]*/ '_csrf'; const csToken=/*[[${_csrf.token}]]*/ '';
        if(csName && csToken){ const c=document.createElement('input'); c.type='hidden'; c.name=csName; c.value=csToken; form.appendChild(c); }
        const s=document.createElement('input'); s.type='hidden'; s.name='status_' + id; s.value=status; form.appendChild(s);
        document.body.appendChild(form); form.submit();
    }
    /*]]>*/
</script>
</body>
</html>