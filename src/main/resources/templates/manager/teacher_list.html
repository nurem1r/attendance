<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Список учителей</title>
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css"/>
</head>
<body>
<div class="container">
    <div class="header-row">
        <div class="header-left">
            <h1>Учителя</h1>
            <div class="small">Список учителей</div>
        </div>
        <div class="header-actions">
            <!-- Заменили кнопку Выйти на Назад (возврат в дашборд менеджера) -->
            <a th:href="@{/manager}" class="btn-consume">Назад</a>
        </div>
    </div>

    <div class="table-card">
        <table>
            <thead>
            <tr><th>ФИО</th><th>Смена</th><th>Студенты</th><th>Действия</th></tr>
            </thead>
            <tbody>
            <tr th:each="t : ${teachers}">
                <td>
                    <div th:text="${t.firstName + ' ' + t.lastName}">Имя Фамилия</div>
                    <div class="kv" th:text="${t.phone}">phone</div>
                </td>

                <!-- Показываем смену по-русски -->
                <td th:text="${t.shift != null ? (t.shift.name() == 'FIRST' ? 'ПЕРВАЯ' : (t.shift.name() == 'SECOND' ? 'ВТОРАЯ' : t.shift.name())) : '-'}">Смена</td>

                <!-- Кол-во студентов из studentsCountMap (ключ — userId) -->
                <td th:text="${studentsCountMap != null && studentsCountMap.containsKey(t.userId) ? studentsCountMap[t.userId] : 0}">0</td>

                <td>
                    <!-- Редактировать: переходит на форму редактирования учителя -->
                    <a th:href="@{/manager/edit_teacher/{id}(id=${t.userId})}" class="btn-letter" title="Редактировать">Изм</a>

                    <!-- Удалить: POST форма с CSRF и подтверждением; данные для подтверждения в data-атрибутах -->
                    <form th:action="@{/manager/delete_teacher}" method="post" style="display:inline"
                          th:attr="data-firstname=${t.firstName},data-lastname=${t.lastName}"
                          onsubmit="return confirmDelete(this);">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <input type="hidden" name="teacherUserId" th:value="${t.userId}"/>
                        <button class="btn-letter delete" type="submit" title="Удалить учителя">Удл</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function confirmDelete(form) {
        try {
            const fn = form.getAttribute('data-firstname') || '';
            const ln = form.getAttribute('data-lastname') || '';
            const name = (ln + ' ' + fn).trim();
            const message = name ? ('Удалить учителя ' + name + '?') : 'Удалить учителя?';
            return confirm(message);
        } catch (e) {
            return confirm('Удалить учителя?');
        }
    }
</script>

<style>
    .btn-letter { border:none; background:transparent; cursor:pointer; padding:4px 6px; margin-right:6px; text-decoration:none; }
    .btn-letter.delete { color:#c33; }
    a.btn-letter { display:inline-block; }

    .btn-letter { border:none; background:transparent; cursor:pointer; padding:4px 6px; margin-right:6px; text-decoration:none; }
    .btn-letter { color:#ed8936; }
    a.btn-letter { display:inline-block; }
</style>
</body>
</html>