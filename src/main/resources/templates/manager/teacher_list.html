<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>–°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π</title>
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css"/>
</head>
<body>
<div class="container">
    <div class="header-row">
        <div class="header-left">
            <h1>–£—á–∏—Ç–µ–ª—è</h1>
            <div class="small">–°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π</div>
        </div>
        <div class="header-actions">
            <!-- –ó–∞–º–µ–Ω–∏–ª–∏ –∫–Ω–æ–ø–∫—É –í—ã–π—Ç–∏ –Ω–∞ –ù–∞–∑–∞–¥ (–≤–æ–∑–≤—Ä–∞—Ç –≤ –¥–∞—à–±–æ—Ä–¥ –º–µ–Ω–µ–¥–∂–µ—Ä–∞) -->
            <a th:href="@{/manager}" class="btn-consume">–ù–∞–∑–∞–¥</a>
        </div>
    </div>

    <div class="table-card">
        <table>
            <thead>
            <tr><th>–§–ò–û</th><th>–°–º–µ–Ω–∞</th><th>–°—Ç—É–¥–µ–Ω—Ç—ã</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
            </thead>
            <tbody>
            <tr th:each="t : ${teachers}">
                <td>
                    <div th:text="${t.firstName + ' ' + t.lastName}">–ò–º—è –§–∞–º–∏–ª–∏—è</div>
                    <div class="kv" th:text="${t.phone}">phone</div>
                </td>

                <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–º–µ–Ω—É –ø–æ-—Ä—É—Å—Å–∫–∏ -->
                <td th:text="${t.shift != null ? (t.shift.name() == 'FIRST' ? '–ü–ï–†–í–ê–Ø' : (t.shift.name() == 'SECOND' ? '–í–¢–û–†–ê–Ø' : t.shift.name())) : '-'}">–°–º–µ–Ω–∞</td>

                <!-- –ö–æ–ª-–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏–∑ studentsCountMap (–∫–ª—é—á ‚Äî userId) -->
                <td th:text="${studentsCountMap != null && studentsCountMap.containsKey(t.userId) ? studentsCountMap[t.userId] : 0}">0</td>

                <td>
                    <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—á–∏—Ç–µ–ª—è -->
                    <a th:href="@{/manager/edit_teacher/{id}(id=${t.userId})}" class="btn-letter" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</a>

                    <!-- –£–¥–∞–ª–∏—Ç—å: POST —Ñ–æ—Ä–º–∞ —Å CSRF –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º; –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ data-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö -->
                    <form th:action="@{/manager/delete_teacher}" method="post" style="display:inline"
                          th:attr="data-firstname=${t.firstName},data-lastname=${t.lastName}"
                          onsubmit="return confirmDelete(this);">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <input type="hidden" name="teacherUserId" th:value="${t.userId}"/>
                        <button class="btn-letter delete" type="submit" title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function confirmDelete(form) {
        try {
            const fn = form.getAttribute('data-firstname') || '';
            const ln = form.getAttribute('data-lastname') || '';
            const name = (ln + ' ' + fn).trim();
            const message = name ? ('–£–¥–∞–ª–∏—Ç—å —É—á–∏—Ç–µ–ª—è ' + name + '?') : '–£–¥–∞–ª–∏—Ç—å —É—á–∏—Ç–µ–ª—è?';
            return confirm(message);
        } catch (e) {
            return confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∏—Ç–µ–ª—è?');
        }
    }
</script>

<style>
    .btn-letter { border:none; background:transparent; cursor:pointer; padding:4px 6px; margin-right:6px; text-decoration:none; }
    .btn-letter.delete { color:#c33; }
    a.btn-letter { display:inline-block; }
</style>
</body>
</html>