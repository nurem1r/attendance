<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>–î–∞—à–±–æ—Ä–¥ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</title>
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css"/>
</head>
<body>
<div class="container">
    <div class="header-row">
        <div class="header-left">
            <h1>–î–∞—à–±–æ—Ä–¥ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</h1>
            <div class="small">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∏—Ç–µ–ª—è–º–∏ –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏</div>
        </div>
        <div class="header-actions">
            <form th:action="@{/logout}" method="post" th:object="${_csrf}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn-consume">–í—ã–π—Ç–∏</button>
            </form>
        </div>
    </div>

    <div class="quick-stats">
        <div class="stat-card">
            <span class="stat-icon">üë®‚Äçüè´</span>
            <div class="stat-number" th:text="${teachers != null ? #lists.size(teachers) : 0}">0</div>
            <div class="stat-label">–£—á–∏—Ç–µ–ª–µ–π</div>
        </div>

        <div class="stat-card">
            <span class="stat-icon">üë®‚Äçüéì</span>
            <!-- Simplified expression: avoid Java stream/lambda in template parsing.
                 If you prefer the real total of students, compute totalStudents in the controller
                 and pass it to the model (recommended). For now we fall back to number of teacher-entries. -->
            <div class="stat-number" th:text="${totalStudents != null ? totalStudents : (studentsCountMap != null ? studentsCountMap.size() : 0)}">0</div>
            <div class="stat-label">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
        </div>

        <div class="stat-card">
            <span class="stat-icon">üìä</span>
            <div class="stat-number" th:text="${activeTeachers != null ? activeTeachers : 0}">0</div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
        </div>
    </div>

    <div class="nav-panel" style="margin-bottom:18px">
        <a class="nav-link" th:href="@{/manager/add_student}">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞</a>
        <span class="separator">|</span>
        <a class="nav-link" th:href="@{/manager/add_teacher}">–î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è</a>
        <span class="separator">|</span>
        <a class="nav-link" th:href="@{/manager/student_list}">–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</a>
        <span class="separator">|</span>
        <a class="nav-link" th:href="@{/manager/teacher_list}">–°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π</a>
    </div>

    <div class="teachers-section">
        <h3>–£—á–∏—Ç–µ–ª—è</h3>

        <div class="teachers-grid" th:if="${!#lists.isEmpty(teachers)}">
            <div th:each="t : ${teachers}" class="teacher-card">
                <div class="teacher-name" th:text="${t.firstName + ' ' + t.lastName}">–ò–º—è –§–∞–º–∏–ª–∏—è</div>

                <div class="teacher-info">
                    <div class="info-row">
                        <span class="info-label">–°–º–µ–Ω–∞:</span>
                        <span class="info-value shift-badge" th:text="${t.shift}">FIRST</span>
                    </div>

                    <div class="info-row">
                        <span class="info-label">–°—Ç—É–¥–µ–Ω—Ç–æ–≤:</span>
                        <span class="students-count">
                <span th:text="${studentsCountMap != null && studentsCountMap.containsKey(t.userId) ? studentsCountMap.get(t.userId) : 0}">0</span>
              </span>
                    </div>
                </div>

                <a class="action-link" th:href="@{/manager/teacher_slots/{id}(id=${t.userId})}">
                    –û—Ç–∫—Ä—ã—Ç—å —Å–ª–æ—Ç—ã
                </a>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(teachers)}" class="empty-state">
            <span class="empty-state-icon">üë®‚Äçüè´</span>
            <h3>–£—á–∏—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–∏—Ç–µ–ª—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å —Å–∏—Å—Ç–µ–º–æ–π.</p>
            <a class="nav-link" th:href="@{/manager/add_teacher}" style="margin-top: 20px; width: auto; display: inline-block;">
                –î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è
            </a>
        </div>
    </div>
</div>
</body>
</html>